%% 11.1
clc, clf, clear
% Population settings
N = 1000;
L = 100;

% Disease settings
infectionRate = 0.6;   % beta

% 11.1
initI = 0.01;
movementProb = 0.8;     % d
recoveryRate = 0.01;    % gamma

% 11.2
deathProb = 0.01;   % mu

%11.3
suseptableProb = 0.01; % alpha

% nEpochs = 10; 
% nTrails = 20;
% Ravg = zeros(nBeta,10);
% inrate = linspace(0,1,nBeta);

% deathP = logspace(-2.7,-1,nEpochs)%0.01;
% Davg = zeros(nEpochs,nTrails)

% for m=1:nEpochs
% deathProb = deathP(m)
% for j=1:nTrails
   
%Initialize population
I = [];
S=[];
R=[];
D=[];
agents = zeros(N,3);
agents(:,1:2) = randi(L,N,2);
agents(1:N*initI,3) = -1;

while sum(agents(:,3)==-1)>0
    agents = Move(agents,movementProb,L);
    agents = Infect(agents,infectionRate);
    agents = Die(agents, deathProb);
    agents = Recover(agents,recoveryRate);
    agents = FromRtoS(agents,suseptableProb);
    
    s = agents(:,3) == 0;
    i = agents(:,3) == -1;
    r = agents(:,3) == 1;
    
    %DrawPlot(agents,L,s,i,r);
 
    S(1,end+1) = sum(s);
    I(1,end+1) = sum(i);
    R(1,end+1) = sum(r);
    D(1,end+1) = N-(S(end)+I(end)+R(end));   
end
% Davg(m,j) = D(end);
% end
% end
% Plot evolution
clf
t = 1:length(I);
figure(2)
plot(t,S,'b')
hold on
plot(t,I,'r')
plot(t,R,'g')
plot(t,D,'black')
axis([0 length(I) 0 N])
xlabel("t")
ylabel("Number of agents")
legend("S","I","R","D")
title("Time evolution of disease")

%%
a = mean(Davg,2)
plot(deathP,a,'.b', 'MarkerSize',10)
xlabel("\mu")
ylabel("D_\infty")
title("Effects of \mu on total number of deaths")
%%
clf
%a = mean(Ravg,2)
b = [10;14.4000000000000;19.8000000000000;58.6000000000000;138.200000000000;250.800000000000;358.400000000000;532.200000000000;670.600000000000;754;795.800000000000;829.800000000000;860.600000000000;870.800000000000;900.400000000000;915.200000000000;900.600000000000;932;935.600000000000;956.600000000000;952.200000000000;949;961.600000000000;954;960.400000000000;969.600000000000;975;974.200000000000;972.400000000000;971.200000000000];
g=[10;11.5000000000000;14.8000000000000;18;24.2000000000000;31.4000000000000;33.7000000000000;49.5000000000000;52.5000000000000;94.9000000000000;112.200000000000;146;163.900000000000;195.200000000000;229.700000000000;233.500000000000;328.500000000000;305.500000000000;365.500000000000;430.900000000000;452.400000000000;508.600000000000;517.700000000000;507;564.200000000000;616.500000000000;573.400000000000;582;648.200000000000;656.100000000000];
plot(inrate,b,'.b', 'MarkerSize',20)
hold on
plot(inrate,g, '.g', 'MarkerSize',20)
xlabel("\beta")
ylabel("R_\infty")
legend("\gamma = 0.01","\gamma = 0.02")
title("Effects of \beta on total number of recovered")

%%
figure(3)
scatter(inrate,inrate./0.01,[],b)



%% Death rate
1:67
deathP = logspace(-3,0,100);
d = [95,82,81,81,74;76,89,84,88,90;90,95,89,93,105;88,107,106,89,99;103,122,99,88,111;116,106,116,117,121;113,114,111,103,101;105,114,115,133,112;132,128,127,137,118;130,141,148,147,151;123,156,158,157,134;147,161,146,145,151;167,190,154,164,144;172,182,180,209,150;172,142,167,196,173;178,153,183,183,192;169,167,203,202,199;191,205,207,206,190;208,220,233,218,174;226,232,194,237,215;217,257,228,218,205;215,250,246,174,221;195,250,197,242,267;222,236,261,253,209;279,255,200,180,275;307,201,250,249,202;194,271,208,263,302;178,137,205,289,203;202,250,267,171,264;263,299,228,178,274;123,151,153,237,162;184,198,193,211,287;312,196,201,226,182;180,116,92,253,153;148,41,54,227,123;90,166,132,103,129;236,78,54,80,78;64,218,218,164,83;58,75,131,87,93;115,57,55,187,17;91,55,15,128,58;28,47,23,99,98;80,41,22,90,36;107,37,37,39,131;20,130,69,10,170;12,24,29,28,31;69,73,67,60,19;58,39,88,40,20;10,57,37,125,50;22,28,47,41,44;23,34,36,30,13;28,26,10,27,14;36,19,16,37,56;44,19,32,15,54;16,17,15,21,20;19,19,18,24,24;39,17,35,20,18;13,17,22,18,29;22,19,12,20,18;19,21,21,25,15;11,16,10,17,11;19,13,17,16,14;10,26,20,27,10;18,18,22,13,16;21,20,11,9,12;17,22,11,17,11;10,9,14,15,16;11,11,10,12,13;13,17,16,15,12;14,15,12,16,12;19,17,14,9,15;15,10,13,12,14;13,14,14,11,12;10,10,10,9,11;14,15,13,18,11;12,13,15,13,12;15,13,11,11,13;10,13,11,11,12;16,15,11,13,16;15,13,12,11,10;10,9,10,12,12;14,12,10,14,12;10,12,11,10,11;10,11,10,9,10;11,12,14,13,10;12,11,11,11,11;12,11,11,14,10;12,10,14,11,10;10,13,10,11,10;12,10,12,14,11;11,10,11,10,10;12,11,10,12,10;11,11,12,10,10;12,13,11,12,11;12,12,10,11,12;10,11,9,11,10;10,11,10,10,10;11,10,12,10,12;11,11,10,11,12;11,10,11,10,10];
plot(deathP(1:67),d(1:67),'.')
xlabel("\mu")
ylabel("D_\infty")
title("Effects of \mu on total number of deaths")

%%
clf
deathP = [0,logspace(-2.7,-1,10)]
deaths=[0, 145.0500,194.1500,217.9000,225.1500,159.2000,77.7500,34.4500,24.7500,17.0000,17.5000];
plot(deathP,deaths,'.','MarkerSize',20)
xlabel("\mu")
ylabel("D_\infty")
title("Effects of \mu on total number of deaths")